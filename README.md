# NHK2024_mbd_R1CylinderDriver2
[参考](https://t-semi.esa.io/posts/57)


R1のエアシリンダドライバその2


現状HAL_Delayを多用しているので動作が遅いです


試験を行うときはエアーが供給されている電磁弁が0 or 4個の時かつ試験直前にリセットを行っている状況に限定することを推奨する

主に
- 苗アームの展開
- ボール回収ハンドの開閉
- ボール回収ハンドの上下
- 飛び出し防止機構
- 装填機構

の制御を担当する

飛び出し防止機構は**装填時のみ飛び出し防止を無効**にすればよいと解釈した

## ピンアサイン
 ![image](https://github.com/T-semi-Tohoku-Uni/NHK2024_mbd_R1CylinderDriver2/assets/43599353/1e62f076-5098-4780-b2e2-6811a0ebd2f0)

### 画像のコネクタの名称と接続先
 - JP1: ハンド開閉用2位置電磁弁(非通電時はハンドを閉じる)(CYL_HND_OC)
 - JP2: ハンド上下用2位置電磁弁(非通電時はハンドを上げる)(CYL_HND_UD)
 - JP3: 飛び出し防止機構用2位置電磁弁(非通電時は飛び出し防止機構を無効，通電時に有効)(CYL_PV)
 - JP4: 装填用2位置電磁弁(非通電時はボール回収時の位置，**not射出機構側**)(CYL_SET)
 - JP5: 苗アーム展開(CYL_ARM_XP)
 - JP6: 苗アーム収納(CYL_ARM_UXP)

装填の関数(Shoot)はハンドを閉，上の状態で装填を行うことを想定しているので，仮にエアーが供給されていて前述の状態でないときはハンドも動くことに注意

## CAN入出力
### 入力
#### ボールハンド
CANID_BALL_HAND(0x102)

Data[0]==0で回収，Data[1]==1で受け入れOK

#### 装填
CANID_SHOOT(0x101)

Data[0]==0で装填 (射出) それ以外の時は何もしない

データを受信してShootが呼び出されるときにフラグisCatchingを確認し，FALSEならハンドを回収状態にしてから装填を行う

#### アーム展開
CANID_ARM_EXPANDER

Data[0]==0で収納，Data[0]==1で展開
